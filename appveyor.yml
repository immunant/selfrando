version: 1.0.{build}

before_build:
- ps: >-
   If ($env:Platform -Match "Win32") {
        $env:VCVARS_PLATFORM="x86"
        $env:SR_PLATFORM_PREFIX=""
   } Else {
        $env:VCVARS_PLATFORM="amd64"
        $env:SR_PLATFORM_PREFIX="x64"
   }
- cmd: call "%VS140COMNTOOLS%\..\..\VC\vcvarsall.bat" %VCVARS_PLATFORM%
- cmd: "SET PATH=C:\\Python27;%PATH%"

build:
  project: self-rando-windows.sln
  parallel: true
  verbosity: minimal

notifications:
- provider: Slack
  auth_token:
    secure: WuzJD0mLtM12sadwBu33d9wz20w10vIXbfYO2omvQwED4YTqk+DImfrBbYl1lewuiKXMs5ma7BV9d4qCzznZJw==
  channel: '#selfrando'
  on_build_success: true
  on_build_failure: true
  on_build_status_changed: true

image: Visual Studio 2015

configuration:
# - Debug # Broken for VS2015 Update 3
- Release

platform:
- Win32 # 32-bit
- x64 # 64-bit

test_script:
- cmd: "python %APPVEYOR_BUILD_FOLDER%\\scripts\\trap-msvc-libs.py"
- cmd: "rmdir /q /s %APPVEYOR_BUILD_FOLDER%\\src\\TrapLinker\\win32\\SimpleRandoTest\\%SR_PLATFORM_PREFIX%\\%CONFIGURATION%"
- cmd: "msbuild /p:Configuration=%CONFIGURATION% /p:Platform=%PLATFORM% /verbosity:minimal /target:SimpleRandoTest"
- cmd: "%APPVEYOR_BUILD_FOLDER%\\%SR_PLATFORM_PREFIX%\\%CONFIGURATION%\\SimpleRandoTest.exe"
